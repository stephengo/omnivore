$(function(){window.initialMessageDisplayed=false;$(document).mouseenter(function(){if(!window.initialMessageDisplayed){var obj=JSON.parse($("#dom-target").text());var answerContainerDiv=jQuery('<div/>',{'class':"bot-answer-container",tabindex:1});$("#chat-text").append(answerContainerDiv);renderRichControls(obj.result.fulfillment.messages,answerContainerDiv);$("#message").focus();window.initialMessageDisplayed=true;}});var guid=($("#sessionId").text()).trim();$('form').on('submit',function(e){var query=$("#message").val();try{sendGAEvent('iFrame',guid,'userSays: '+query);}
catch(e){console.log(e);}
showUserText();e.preventDefault();$.ajax({type:'post',url:'process.php',data:{submit:true,message:query,sessionid:guid},success:function(response){var obj=JSON.parse(response);var event=obj.result.action;var answerContainerDiv=jQuery('<div/>',{'class':"bot-answer-container",tabindex:1});$("#chat-text").append(answerContainerDiv);var textFromDefaultResponse=obj.result.fulfillment.speech;if(textFromDefaultResponse.trim()!==''){renderDefaultResponse(textFromDefaultResponse,answerContainerDiv);}
renderRichControls(obj.result.fulfillment.messages,answerContainerDiv);$(answerContainerDiv).focus();$(answerContainerDiv).blur();var isDisabled=$('#message').prop('disabled');if(isDisabled===false){$("#message").focus();}
try{sendGAEvent('iFrame',guid,'botSays: '+obj.result.fulfillment.speech)}
catch(e){console.log(e);}}});});});function renderDefaultResponse(textFromDefaultResponse,parent){var simpleResponseDiv=jQuery('<div/>',{'class':'card mdb-color lighten-2 text-center z-depth-2'});var simpleResponseInnerDiv=jQuery('<div/>',{'class':'card-body'});var simpleResponseText=jQuery('<p/>',{'class':'white-text mb-0',html:textFromDefaultResponse,tabindex:1});simpleResponseInnerDiv.css("font-size","14px");simpleResponseDiv.css("padding","5px");simpleResponseDiv.append(simpleResponseInnerDiv);simpleResponseInnerDiv.append(simpleResponseText);parent.append(simpleResponseDiv);}
function renderRichControls(data,parent){var i,len=data.length;for(i=0;i<len;i++){if(data[i]&&data[i].hasOwnProperty('type')){if(data[i]['type']==='link_out_chip'&&data[i]['platform']==='google'){renderLinkOutSuggestion(data[i],parent);}
if(data[i]['type']==='simple_response'&&data[i]['platform']==='google'){renderSimpleResponse(data[i],parent);}
if(data[i]['type']==='basic_card'&&data[i]['platform']==='google'){renderBasicCard(data[i],parent);}
if(data[i]['type']==='list_card'&&data[i]['platform']==='google'){renderList(data[i],parent);}
if(data[i]['type']==='carousel_card'&&data[i]['platform']==='google'){renderCarousel(data[i],parent);}}}
for(i=0;i<len;i++){if(data[i]&&data[i].hasOwnProperty('type')){if(data[i]['type']==='suggestion_chips'&&data[i]['platform']==='google'){renderSuggestionChips(data[i],parent);}}}}
function renderList(data,parent){var titleOfCard=data['title'];var i,len=data['items'].length;var listGroup=jQuery('<div/>',{'class':'list-group card'});listGroup.css("margin","0 auto");listGroup.css("maxWidth","70%");listGroup.css("float","right");var listGroupHeading=jQuery('<div/>',{'class':'card-header deep-orange lighten-1 white-text','html':titleOfCard});listGroupHeading.css("text-align","center");listGroupHeading.css("font-size","18px");listGroup.append(listGroupHeading);for(i=0;i<len;i++){var item=data['items'][i];if(item){var optionTitle=item["title"];var optionDescription=item["description"];var optionKey=item["optionInfo"]["key"];var imageUrl;if(item["image"]){imageUrl=item["image"]["url"];}
var anchor=jQuery('<a/>',{'data-key':optionKey,'class':'list-group-item list-group-item-action flex-column align-items-start'});anchor.click(function(){if(window.currentSuggestionChips){var buttonRow=window.currentSuggestionChips;buttonRow.remove();window.currentSuggestionChips=null;$("#message").removeAttr("disabled");}
var textToSubmit=$(this).attr('data-key');$("#message").val(textToSubmit);$("form").trigger("submit");});var headingDiv=jQuery('<div/>',{});var heading=jQuery('<div/>',{'class':'card-title','text':optionTitle});heading.css("font-weight","bold");var row=jQuery('<div/>',{'class':'row'});var colText=jQuery('<div/>',{'class':'col-xs-8'});var colImage=jQuery('<div/>',{'class':'col-xs-4'});var para=jQuery('<p/>',{'class':'mb-1','html':optionDescription});if(imageUrl){var img=jQuery('<img/>',{'class':'img-fluid','src':imageUrl,'width':'50px'});colImage.append(img);}
row.append(colText);row.append(colImage);headingDiv.append(heading);headingDiv.append(para);colText.append(headingDiv);anchor.append(row);listGroup.append(anchor);}}
parent.append(listGroup);}
function renderCarousel(data,parent){var i,len=data['items'].length;var carouselContainer=jQuery('<div/>',{'width':'550px'});var listGroup=jQuery('<ul/>',{});for(i=0;i<len;i++){var item=data['items'][i];if(item){var optionTitle=truncateString(item["title"],20);var optionDescription=item["description"];var optionKey=item["optionInfo"]["key"];var imageUrl=item["image"]["url"];var listItem=jQuery('<li/>',{});var cardDiv=jQuery('<div/>',{'width':'200px','height':'220px'});var anchor=jQuery('<a/>',{'data-key':optionKey,'class':'list-group-item list-group-item-action flex-column align-items-start'});anchor.click(function(){if(window.currentSuggestionChips){var buttonRow=window.currentSuggestionChips;buttonRow.remove();window.currentSuggestionChips=null;$("#message").removeAttr("disabled");}
var textToSubmit=$(this).attr('data-key');$("#message").val(textToSubmit);$("form").trigger("submit");});var heading=jQuery('<div/>',{'class':'card-title','text':optionTitle});heading.css("font-weight","bold");var para=jQuery('<p/>',{'class':'mb-1','html':optionDescription});var divForImage=jQuery('<div/>',{'class':'card-title'});divForImage.css("height","100px");var img=jQuery('<img/>',{'class':'img-fluid','src':imageUrl,'width':'100px'});img.css("margin-left","auto");img.css("margin-right","auto");img.css("display","block");divForImage.append(img);cardDiv.append(divForImage);anchor.append(heading);anchor.append(para);cardDiv.append(anchor);listItem.append(cardDiv);listGroup.append(listItem);}}
parent.append(carouselContainer);carouselContainer.append(listGroup);$(listGroup).lightSlider({autoWidth:true});}
function renderBasicCard(data,parent){var cardDiv=jQuery('<div/>',{'class':'card','width':'300px'});$(cardDiv).css({marginLeft:"5px",marginRight:"5px"});var img=jQuery('<img/>',{'class':'img-fluid','src':data['image']['url']});var cardBodyDiv=jQuery('<div/>',{'class':'card-body'});var strTitle=truncateString(data['title'],28);var cardTitleContainerDiv=jQuery('<div/>',{'class':'card-text-container-div'});var cardTitle=jQuery('<h4/>',{'class':'card-title',text:strTitle,width:'90%'});cardTitleContainerDiv.append(cardTitle);var hr=jQuery('<hr/>',{});var textContainerDev=jQuery('<div/>',{'class':'card-text-container-div'});var cardText=jQuery('<p/>',{text:data['formattedText'],'class':'card-text'});cardText.css("font-size","14px");var cardLinkText=jQuery('<p/>',{'class':'card-text'});var link=document.createElement('a');var linkText=document.createTextNode((data['buttons'][0])['title']);link.appendChild(linkText);link.title=(data['buttons'][0])['title'];link.href=(data['buttons'][0])['openUrlAction']['url'];link.target='_blank';cardLinkText.append(link);cardLinkText.css("font-size","14px");cardDiv.append(img);cardBodyDiv.append(cardTitleContainerDiv);cardBodyDiv.append(hr);cardBodyDiv.append(textContainerDev);textContainerDev.append(cardText);textContainerDev.append(cardLinkText);cardDiv.append(cardBodyDiv);parent.append('<br/>');parent.append(cardDiv);}
function truncateString(input,charLimit){if(input.length>charLimit){return input.truncate(charLimit)+"...";}
else{return input;}}
String.prototype.truncate=String.prototype.truncate||function(n){return this.slice(0,n);};function renderSimpleResponse(data,parent){var simpleResponseDiv=jQuery('<div/>',{'class':'card mdb-color lighten-2 text-center z-depth-2'});var simpleResponseInnerDiv=jQuery('<div/>',{'class':'card-body'});var simpleResponseText=jQuery('<p/>',{'class':'white-text mb-0',html:data['textToSpeech'],tabindex:1});var lineBreak=jQuery('<br/>');simpleResponseInnerDiv.css("font-size","14px");simpleResponseDiv.css("padding","5px");simpleResponseDiv.css("margin","5px");simpleResponseDiv.css("display","inline-block");simpleResponseDiv.css("maxWidth","300px");simpleResponseDiv.css("float","right");simpleResponseDiv.append(simpleResponseInnerDiv);simpleResponseInnerDiv.append(simpleResponseText);parent.append(simpleResponseDiv);parent.append(lineBreak);}
function renderLinkOutSuggestion(data,parent){var link=document.createElement('a');var linkText=document.createTextNode(data['destinationName']);link.appendChild(linkText);link.title=data['destinationName'];link.href=data['url'];link.target='_blank';var linkoutDiv=jQuery('<div/>',{tabindex:1,'class':"card lighten-2 text-center z-depth-2"});var linkoutInnerDiv=jQuery('<div/>',{'class':'card-body',html:link});linkoutInnerDiv.css("font-size","14px");linkoutDiv.css("padding","5px");linkoutDiv.css("margin","5px");linkoutDiv.css("display","inline-block");linkoutDiv.css("float","right");linkoutDiv.css("maxWidth","300px");var lineBreak=jQuery('<br/>');linkoutDiv.append(linkoutInnerDiv);parent.append(linkoutDiv);parent.append(lineBreak);}
function renderSuggestionChips(data,parent){var i,len=data['suggestions'].length;var buttonRowDiv=jQuery('<div/>',{});var buttonRow=jQuery('<div/>',{tabindex:1});for(i=0;i<len;i++){if(data["suggestions"][i]){var buttonText=data["suggestions"][i]['title'];var button=jQuery('<button/>',{type:'button',class:'btn btn-primary',text:buttonText});button.click(function(){var textToSubmit=this.textContent;buttonRow.remove();window.currentSuggestionChips=null;$("#message").removeAttr("disabled");$("#message").val(textToSubmit);$("form").trigger("submit");});}
buttonRow.append(button);}
buttonRowDiv.css("clear","both");buttonRowDiv.css("display","inline-block");buttonRowDiv.css("float","right");buttonRowDiv.css("margin","5px");buttonRowDiv.css("padding","5px");buttonRowDiv.append(buttonRow);parent.append(buttonRowDiv);window.currentSuggestionChips=buttonRow;$("#message").attr("disabled","disabled");}
function getValueByKey(key,data){var i,len=data.length;for(i=0;i<len;i++){if(data[i]&&data[i].hasOwnProperty(key)){return data[i][key];}}
return-1;}
function sendGAEvent(category,action,label){}
function showUserText(){var div=jQuery('<div/>',{text:$("#message").val(),'class':"rounded-div",tabindex:1});$("#chat-text").append(div);$("#message").val('');}